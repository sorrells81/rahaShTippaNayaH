box: debian
build:
  steps:
    - install-packages:
        packages: git ssh-client
    - add-ssh-key:
        keyname: github_key
        host: github.com
    - add-to-known_hosts:
        hostname: github.com
        fingerprint: 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48
        type: rsa
    - script:
        name: initialize git submodules
        code: |
            git submodule update --init --recursive
    - script:
        name: update themes
        code: |
            git submodule foreach "(git checkout master; git pull)&"
    - arjen/hugo-build:
        version: "0.53"
        theme: "sanskrit-documentation-theme-hugo"
        flags: --buildDrafts=true
#    - arjen/hugo-build:
#        version: "0.53"
#        theme: "sanskrit-documentation-theme-hugo"
#        flags: --buildDrafts=true
#        config: config_offline_android.toml
deploy:
  steps:
    - install-packages:
        packages: git ssh-client
    - add-ssh-key:
        keyname: github_key
        host: bitbucket.org
    - add-to-known_hosts:
        hostname: bitbucket.org
        fingerprint: zzXQOXSRBEiUtuE8AikJYKwbHaxvSc0ojez9YXaGp1A
        type: rsa
    - gsserge/git-push:
        host: bitbucket.org
        repo: agnirahas/agnirahas.bitbucket.org
        branch: master
        basedir: build_bitbucket
        discard_history: true
# The final step above is failing - https://github.com/lvivier/step-gh-pages/issues/15 . Yet to figure out why.